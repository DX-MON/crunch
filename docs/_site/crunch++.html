<!doctype html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>crunch++ User Guide | crunch</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="crunch++ User Guide" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="crunch your code. Crunch is a unit testing framework written for C and C++." />
<meta property="og:description" content="crunch your code. Crunch is a unit testing framework written for C and C++." />
<meta property="og:site_name" content="crunch" />
<script type="application/ld+json">
{"@type":"WebPage","description":"crunch your code. Crunch is a unit testing framework written for C and C++.","headline":"crunch++ User Guide","url":"/crunch++.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link rel="stylesheet" href="/assets/css/style.css?v=c257ced7b550ca4c46fda5946fca488fce59ae4f">
		<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
		<script src="/assets/js/respond.js"></script>
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<!--[if lt IE 8]>
		<link rel="stylesheet" href="/assets/css/ie.css">
		<![endif]-->
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	</head>
	<body>
		<nav class="sidebar nav">
			<h1>crunch</h1>
			<ul>
				<li class="link"><a href="/">Introduction</a></li>
				<li class="link"><a href="/build-and-install">Build and Install</a></li>
				<li class="link"><a href="/crunch">crunch User Guide</a></li>
				<li class="link"><a href="/crunch++">crunch++ User Guide</a></li>
				<li class="fork"><a href="https://github.com/DX-MON/crunch">View On GitHub</a></li>
			
				<li class="title">Downloads</li>
				<li class="downloads">
					<a href="https://github.com/DX-MON/crunch/releases">Releases</a>
				</li>
				<li class="downloads">
					<a href="https://github.com/DX-MON/crunch/zipball/master">Development Zip</a>
				</li>
				<li class="downloads">
					<a href="https://github.com/DX-MON/crunch/tarball/master">Development Tarball</a>
				</li>
			
			</ul>
		</nav><!-- end header -->

		<div class="wrapper">
			<section>
			
			

				<h1 id="crunch-user-guide"><code class="highlighter-rouge">crunch++</code> User Guide</h1>

<p>Table of Contents</p>

<ol>
  <li><a href="#basic-crunch-usage">Basic <code class="highlighter-rouge">crunch++</code> Usage</a>
    <ol>
      <li><a href="#writing-a-simple-test-suite">Writing a Simple Test Suite</a></li>
      <li><a href="#writing-a-test-case">Writing a Test Case</a></li>
      <li><a href="#conditionally-skipping-tests-and-suites">Conditionally Skipping Tests and Suites</a></li>
    </ol>
  </li>
  <li><a href="#crunch-assertions-reference"><code class="highlighter-rouge">crunch++</code> Assertions Reference</a></li>
  <li><a href="getting-the-most-out-of-crunchmake-for-crunch-suites">Getting the Most Out of <code class="highlighter-rouge">crunchMake</code> for <code class="highlighter-rouge">crunch++</code> Suites</a></li>
</ol>

<h2 id="basic-crunch-usage">Basic <code class="highlighter-rouge">crunch++</code> usage</h2>

<p>NOTE: In this release, <code class="highlighter-rouge">testsuit</code> is a historical and deprecated alias of <code class="highlighter-rouge">testsuite</code>, prefer <code class="highlighter-rouge">testsuite</code>.</p>

<h3 id="writing-a-simple-test-suite">Writing a Simple Test Suite</h3>

<p>A <code class="highlighter-rouge">crunch++</code> test suite is a C++ file compiled using <code class="highlighter-rouge">crunchMake</code>.
<code class="highlighter-rouge">crunchMake</code> will automatically build the suite against <code class="highlighter-rouge">crunch++</code> when it detects a C++ file extension such as .cxx or .cpp.</p>

<p>A valid, albeit empty, suite takes the following basic form:</p>

<pre><code class="language-C++">#include &lt;crunch++.h&gt;

class testSuite final : public testsuite
{
public:
	void registerTests() final override { }
};

CRUNCHpp_TEST void registerCXXTests();
void registerCXXTests() { registerTestClasses&lt;testSuite&gt;(); }
</code></pre>

<p>With this, your suite should build and link, and <code class="highlighter-rouge">crunch++</code> should detect the presense of a valid suite in the resulting library and be able to run it.</p>

<p>To test this, save the above snippet as <code class="highlighter-rouge">test.cxx</code>, and run the following:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crunchMake test.cxx
crunch++ <span class="nb">test</span>
</code></pre></div></div>

<p>The result should be:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crunchMake test.cxx
c++ <span class="nt">-fPIC</span> <span class="nt">-DPIC</span> <span class="nt">-fvisibility</span><span class="o">=</span>hidden <span class="nt">-fvisibility-inlines-hidden</span> <span class="nt">-std</span><span class="o">=</span>c++11  test.cxx <span class="nt">-shared</span> <span class="nt">-I</span>/usr/include <span class="nt">-L</span>/usr/lib <span class="nt">-Wl</span>,-rpath,/usr/lib <span class="nt">-lcrunch</span>++ <span class="nt">-O2</span> <span class="nt">-pthread</span> <span class="nt">-o</span> test.so

<span class="nv">$ </span>crunch++ <span class="nb">test
</span>Running <span class="nb">test </span>suite test...
Running tests <span class="k">in </span>class 9testSuite...
Total tests: 0,  Failures: 0,  Pass rate: <span class="nt">--</span>
</code></pre></div></div>

<h3 id="writing-a-test-case">Writing a Test Case</h3>

<p>Building on the previous section, we can easily expand this stub suite to contain a test with a simple assertion.</p>

<p>Within the type <code class="highlighter-rouge">testSuite</code>, we can start by declaring a private section and a function that takes no arguments and returns nothing, just before the public section. Additionally, the function may call any code it likes, can make test assertions and can pass the <code class="highlighter-rouge">this</code> pointer for the suite to any function, as normal:</p>

<pre><code class="language-C++">private:
	void testCase()
	{
		assertNotNull(this);
		assertTrue(true);
	}
</code></pre>

<p>We also need to register the new test case using the registerTests function on the suite:</p>

<pre><code class="language-C++">	void registerTests() final
	{
		CXX_TEST(testCase)
	}
</code></pre>

<p>With this added, rebuild and re-run the test suite:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crunchMake test.cxx
c++ <span class="nt">-fPIC</span> <span class="nt">-DPIC</span> <span class="nt">-fvisibility</span><span class="o">=</span>hidden <span class="nt">-fvisibility-inlines-hidden</span> <span class="nt">-std</span><span class="o">=</span>c++11  test.cxx <span class="nt">-shared</span> <span class="nt">-I</span>/usr/include <span class="nt">-L</span>/usr/lib <span class="nt">-Wl</span>,-rpath,/usr/lib <span class="nt">-lcrunch</span>++ <span class="nt">-O2</span> <span class="nt">-pthread</span> <span class="nt">-o</span> test.so

<span class="nv">$ </span>crunch++ <span class="nb">test
</span>Running <span class="nb">test </span>suite test...
Running tests <span class="k">in </span>class 9testSuite...
testCase...                                                                          <span class="o">[</span>  OK  <span class="o">]</span>
Total tests: 1,  Failures: 0,  Pass rate: 100.00%
</code></pre></div></div>

<h3 id="conditionally-skipping-tests-and-suites">Conditionally Skipping Tests and Suites</h3>

<p><code class="highlighter-rouge">crunch++</code> allows us to do run-time detection that a test or suite does not apply or meet its run conditions (for example, because of missing environment variables) and provides a simple mechanism to do this.</p>

<p>Building on the suite so far, we can demonstrate this by adding a second test case to the existing suite, and defining a second suite in the same file. Add the following just after the end of <code class="highlighter-rouge">testCase()</code>:</p>

<pre><code class="language-C++">	void testSkip()
	{
		skip("Intentionally skipping this test");
	}
</code></pre>

<p>Register the test:</p>

<pre><code class="language-C++">	[...]
	{
		CXX_TEST(testCase)
		CXX_TEST(testSkip)
	}
</code></pre>

<p>We can then define a second suite in the same file, add the following after the end of the first suiteâ€™s class definition:</p>

<pre><code class="language-C++">class testSkipSuite final : public testsuite
{
public:
	void registerTests() final
	{
		skip("Intentionally skipping this suite");
	}
};
</code></pre>

<p>With this, the suite registration can be modified to register this suite too as follows:</p>

<pre><code class="language-C++">void registerCXXTests()
{
	registerTestClasses&lt;testSuite, testSkipSuite&gt;();
}
</code></pre>

<p>Building and re-running the suite should result in this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crunchMake test.cxx
c++ <span class="nt">-fPIC</span> <span class="nt">-DPIC</span> <span class="nt">-fvisibility</span><span class="o">=</span>hidden <span class="nt">-fvisibility-inlines-hidden</span> <span class="nt">-std</span><span class="o">=</span>c++11  test.cxx <span class="nt">-shared</span> <span class="nt">-I</span>/usr/include <span class="nt">-L</span>/usr/lib <span class="nt">-Wl</span>,-rpath,/usr/lib <span class="nt">-lcrunch</span>++ <span class="nt">-O2</span> <span class="nt">-pthread</span> <span class="nt">-o</span> test.so

<span class="nv">$ </span>crunch++ <span class="nb">test
</span>Running <span class="nb">test </span>suite test...
Running tests <span class="k">in </span>class 9testSuite...
testCase...                                                                          <span class="o">[</span>  OK  <span class="o">]</span>
testSkip...
Skipping: Intentionally skipping this <span class="nb">test</span>                                           <span class="o">[</span> SKIP <span class="o">]</span>
Running tests <span class="k">in </span>class 13testSkipSuite...
Skipping: Intentionally skipping this suite                                          <span class="o">[</span> SKIP <span class="o">]</span>
Total tests: 3,  Failures: 0,  Pass rate: 100.00%
</code></pre></div></div>

<h2 id="crunch-assertions-reference"><code class="highlighter-rouge">crunch++</code> Assertions Reference</h2>

<p>The equality assertions exist to remove the dependency on possibly overriden quality operators, which have the potential if themselves left untested to introduce errors and false assertion results into a test suite. This is especially true if your test requires a lot of external library headers.</p>

<p><code class="highlighter-rouge">crunch++</code> comes with two kinds of affirmative equality assertion - fundamental pointer traits and general value assertions - and two boolean equality assertions.</p>

<p>Reference Table of Contents</p>

<ul>
  <li><a href="#positive-equality-assertions">Positive Equality Assertions</a></li>
  <li><a href="#negative-equality-assertions">Negative Equality Assertions</a></li>
  <li><a href="#boolean-equality-assertions">Boolean Equality Assertions</a></li>
  <li><a href="#inequality-assertions">Inequality Assertions</a></li>
</ul>

<p>The pointer trait assertions provided work with <code class="highlighter-rouge">std::unique_ptr&lt;&gt;</code> out the box.</p>

<p>The trivial value integer assertions work with mis-matched integers out the box.</p>

<h3 id="positive-equality-assertions">Positive Equality Assertions</h3>

<ul>
  <li><code class="highlighter-rouge">assertNull</code> - Checks that the provided pointer, regardless of const-ness, is equivilent to a nullptr.</li>
  <li><code class="highlighter-rouge">assertEqual</code> - Checks that two entities have the same value.</li>
</ul>

<p><code class="highlighter-rouge">assertNull</code> takes one parameter, the pointer to check. If this parameter is not <code class="highlighter-rouge">nullptr</code>, the assertion fails and prints a diagnostic, aborting the test case.</p>

<p>There are several forms of <code class="highlighter-rouge">assertEqual</code> check: Trivial value assertions for integers, C strings, STL strings, STL string views, characters, floating point values and direct address comparisons; and a more complex kind of assertion for validating arbitrary memory contents.</p>

<p>The trivial form of <code class="highlighter-rouge">assertEqual</code> takes two parameters - <code class="highlighter-rouge">result</code>, and <code class="highlighter-rouge">expected</code> - in that order.
When the assertion fails, it print a diagnostic and aborts the test case.</p>

<p>The complex form of <code class="highlighter-rouge">assertEqual</code> has the signature</p>

<pre><code class="language-C++">void assertEqual(const void *const result, const void *const expected, const size_t expectedLength);
</code></pre>

<p>This allows for safe comparison of two blocks of memory, so allowing arbitrary object comparisons.
When the two memory blocks have different contents, the assertion fails and prints a diagnostic, aborting the test case.</p>

<h3 id="negative-equality-assertions">Negative Equality Assertions</h3>

<ul>
  <li><code class="highlighter-rouge">assertNotNull</code> - Checks that the provided pointer, regardless of const-ness is not equivilent to nullptr.</li>
  <li><code class="highlighter-rouge">assertNotEqual</code> - Checks that one entityâ€™s value is not the same as the other.</li>
</ul>

<p><code class="highlighter-rouge">assertNotNull</code> takes one parameter, the pointer to check. If this parameter is <code class="highlighter-rouge">nullptr</code>, the assertion fails and prints a diagnostic, aborting the test case.</p>

<p>There are several forms of <code class="highlighter-rouge">assertNotEqual</code> check: Trivial value assertions for integers, C strings, STL strings, STL string views, characters, floating point values and direct address comparisons; and a more complex kind of assertion for validating arbitrary memory contents.</p>

<p>The trivial form of <code class="highlighter-rouge">assertNotEqual</code> takes two parameters - <code class="highlighter-rouge">result</code>, and <code class="highlighter-rouge">expected</code> - in that order.
If the two values are the same, the assertion fails and prints a diagnostic, aborting the test case.</p>

<p>The complex form of <code class="highlighter-rouge">assertNotEqual</code> has the signature</p>

<pre><code class="language-C++">void assertNotEqual(const void *const result, const void *const expected, const size_t expectedLength);
</code></pre>

<p>This allows for safe comparison of two blocks of memory, as with <code class="highlighter-rouge">assertEqual</code>.
If the two blocks have identical contents, the assertion fails and prints a diagnostic, aborting the test case.</p>

<h3 id="boolean-equality-assertions">Boolean Equality Assertions</h3>

<ul>
  <li><code class="highlighter-rouge">assertTrue</code></li>
  <li><code class="highlighter-rouge">assertFalse</code></li>
</ul>

<p>Each of these takes a boolean-converted value and checks it holds the value given by the functionâ€™s name.
If the value checked evaluates to something other than the desired boolean value, the assertion fails printing a diagnostic and aborting the test case.</p>

<h3 id="inequality-assertions">Inequality Assertions</h3>

<ul>
  <li><code class="highlighter-rouge">assertGreaterThan</code> - Checks that <code class="highlighter-rouge">result</code> is greater than <code class="highlighter-rouge">expected</code></li>
  <li><code class="highlighter-rouge">assertLessThan</code> - Checks that <code class="highlighter-rouge">result</code> is less than <code class="highlighter-rouge">expected</code></li>
</ul>

<p>These are integer-only assertions for performing range and broad value checks, aka inequalities.
Both assertions take two parameters in order: <code class="highlighter-rouge">result</code> and <code class="highlighter-rouge">expected</code>.
On failure, these print a diagnostic and abort the test case.</p>

<h2 id="getting-the-most-out-of-crunchmake-for-crunch-suites">Getting the Most Out of <code class="highlighter-rouge">crunchMake</code> for <code class="highlighter-rouge">crunch++</code> Suites</h2>


			</section>
		</div>
	</body>
</html>
